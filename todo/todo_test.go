package todo

import (
	"testing"
	"time"

	"github.com/Jakkrittkt/hugeman-assignment-golang-todo/todo/model"
	"github.com/Jakkrittkt/hugeman-assignment-golang-todo/todo/payload"
	"github.com/go-playground/validator/v10"
	"github.com/google/uuid"
	"github.com/stretchr/testify/assert"
)

var validate = validator.New()

type FakeDb struct{}

func (*FakeDb) New(*model.Todo) error {
	return nil
}
func (*FakeDb) GetById(*model.Todo) error {
	return nil
}
func (*FakeDb) List(todos *[]model.Todo, filter *payload.FilterTodo) error {
	*todos = append(*todos, model.Todo{
		ID:          uuid.New(),
		Title:       "Test title",
		Description: "Test Description",
		Date:        time.Now(),
		Image:       "data:image/png;base64,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",
		Status:      "IN_PROGRESS",
	})

	return nil
}
func (*FakeDb) Update(*model.Todo) error {
	return nil
}

type TestValidate struct {
	code int
	v    map[string]interface{}
}

func (*TestValidate) Bind(v interface{}) error {
	if err := validate.RegisterValidation("imageBase64", CustomValidateImageBase64); err != nil {
		return err
	}
	*v.(*payload.CreateTodo) = payload.CreateTodo{}

	err := validate.Struct(*v.(*payload.CreateTodo))
	return err
}
func (c *TestValidate) JSON(code int, v interface{}) {
	c.code = code
	c.v = v.(map[string]interface{})
}
func (c *TestValidate) Param(string) string {
	return ""
}
func (c *TestValidate) Query(string) string {
	return ""
}
func TestRequireFieldPayloadHasFail(t *testing.T) {
	fakedb := &FakeDb{}
	handler := NewTodoHandler(fakedb)
	c := &TestValidate{}

	handler.Create(c)

	assert.Equal(t, 400, c.code, "Should got status code 400")
}

type TestCreateTodo struct {
	code int
	v    map[string]interface{}
}

func (*TestCreateTodo) Bind(v interface{}) error {
	*v.(*payload.CreateTodo) = payload.CreateTodo{
		Title:       "TestCreate",
		Description: "Test",
		Image:       "data:image/png;base64,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",
		Status:      "IN_PROGRESS",
	}
	return nil
}
func (c *TestCreateTodo) JSON(code int, v interface{}) {
	c.code = code
	c.v = v.(map[string]interface{})

}
func (c *TestCreateTodo) Param(string) string {
	return "1c7f6ab2-dc5c-4a33-ae33-b1043ff9207b"
}
func (c *TestCreateTodo) Query(s string) string {
	query := map[string]interface{}{"sort": "", "order": "", "search": ""}
	return query[s].(string)
}

func TestCreateTodoSuccess(t *testing.T) {
	assert := assert.New(t)
	fakedb := &FakeDb{}
	handler := NewTodoHandler(fakedb)
	c := &TestCreateTodo{}

	handler.Create(c)

	assert.Equal(201, c.code, "Should got status code 201")

	_, ok := c.v["id"]
	assert.True(ok, "Should got field id")
	_, ok = c.v["title"]
	assert.True(ok, "Should got field title")
	_, ok = c.v["description"]
	assert.True(ok, "Should got field description")
	_, ok = c.v["date"]
	assert.True(ok, "Should got field date")
	_, ok = c.v["image"]
	assert.True(ok, "Should got field image")
	_, ok = c.v["status"]
	assert.True(ok, "Should got field status")

	assert.Equal(6, len(c.v), "Should got total 6 fields")
}

type TestGetListTodo struct {
	*TestCreateTodo
	code int
	v    []model.Todo
}

func (c *TestGetListTodo) JSON(code int, v interface{}) {

	c.code = code
	c.v = v.([]model.Todo)

}
func TestGetTodoListSuccess(t *testing.T) {
	assert := assert.New(t)
	fakedb := &FakeDb{}
	handler := NewTodoHandler(fakedb)
	c := &TestGetListTodo{}

	handler.FindAll(c)

	assert.Equal(200, c.code, "Should got status code 200")

}

type TestUpdateTodo struct {
	*TestCreateTodo
	code int
	v    model.Todo
}

func (c *TestUpdateTodo) Bind(v interface{}) error {
	*v.(*payload.UpdateTodo) = payload.UpdateTodo{
		Title:       "TestCreate",
		Description: "Test",
		Image:       "data:image/png;base64,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",
		Status:      "IN_PROGRESS",
	}
	return nil
}
func (c *TestUpdateTodo) JSON(code int, v interface{}) {
	c.code = code
	c.v = v.(model.Todo)
}

func TestUpdateTodoSuccess(t *testing.T) {
	assert := assert.New(t)
	fakedb := &FakeDb{}
	handler := NewTodoHandler(fakedb)
	c := &TestUpdateTodo{}

	handler.UpdateById(c)

	assert.Equal(200, c.code, "Should got status code 200")
	assert.Equal("1c7f6ab2-dc5c-4a33-ae33-b1043ff9207b", c.v.ID.String())
}
